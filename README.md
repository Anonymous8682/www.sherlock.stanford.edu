# Sherlock tangly web of webs

The Sherlock web presence is made of 3 components, each living in its own
branch of the [stanford-rc/sherlock](https://github.com/stanford-rc/sherlock) GitHub repository:

  1. a [landing page](#landing-page) (in branch
     [`web_landing`][url_landing_branch]
  2. a [theme](#idocumentation-theme) for the documentation pages (in branch
     [`web_theme`][url_theme_branch]
  3. [documentation pages](#documentation-pages), generated from Markdown by
     [MkDocs][url_mkdocs] (in branch [`web_docs`][url_docs_branch])

Each of those components has two parts:

  * a *source* directory, where modifications can be done,
  * a *build* directory, where final output is generated by a script

# Workflow

Each branch contains a [Travis][url_travis] configuration file, that will, on
each commit:

1. build the branch contents
2. deploy the generated contents if the build is successful

So for instance, a commit in the landing page branch will generate a Travis
build of the landing page, and the resulting HTML contents will be pushed and
committed to the `src/` directory in the `sh_docs` branch.

This `sh_docs` branch commit will in turn generate a Travis build of the MkDocs
pages, which will get pushed to the `gh-pages` branch for final publication.

Basically:
* commit to landing page -> commit to docs -> publication
* commit to theme -> commit to docs -> publication
* commit to docs -> publication

So any change to any of the components will be automatically reflected in the
published site. But a modification to the landing page does not require
rebuilding the theme. And an update of the docs content does not trigger a full
rebuild of the landing page nor the theme either, just the docs themselves.

Here's an overview of the whole workflow:

![webs][url_webs]
([edit][url_webs_edit]



# Components

## Landing page

The landing page is ultimately a single static `index.html` file, with a couple
of associated Javascript, CSS and images files.

It lives in the [`web_landing`][url_landing_branch] of the [Sherlock
repository][url_repo]

### Modify

The sources files are separated between:

* content and structure: in `index.html`
* style in `less/seb.less`

### Manual build and deploy

To build the landing page:

```
npm install
gulp build
```

This will generate the static content in the `build/` directory. Then, the
contents of the `build/` directory will need to be pushed to the `src/`
directory in the [`seb_docs`][url_docs_branch] branch for the next stage.


### Automated build and deploy

When commiting new changes to that directory, and pushing them to GitHub, the
`.travis.yml` file will take care of:

* pulling the changes
* building the page
* pushing and commiting the resulting build to [`seb_docs`][url_docs_branch]

That last step will trigger a new deployment of the whole site and its
publication.

So the only required step is to commit the changes and push them to GitHub.





## Documentation theme

The theme is a modified version of [Material for MkDocs][url_mkdocs_material].
It generates a set of static HTML, JS and CSS files.

It lives in the [`web_theme`][url_theme_branch] of the [Sherlock
repository][url_repo]

### Modify

Modify things in `src/`

### Manual build and deploy

To install dependencies:
```
pip install -r requirements.txt
yarn install
```

To build it:
```
yarn run build
```

The contents of the `build/` directory will then need to be pushed to
`src/theme` in the [`web_docs`][url_docs_branch] branch for the next stage.

### Automated build and deploy

Commit and push.




## Documentation pages

The documentation pages are served by [MkDocs][url_mkdocs], which transform
easy-to-edit Markdown files to HTML contents.

It lives in the [`web_docs`][url_docs_branch] of the [Sherlock
repository][url_repo]


### Modify

All the Markdown files live in `src/docs` and the MkDocs configuration
(structure, plugins, site settings) are in `mkdocs.yml`

### Manual build and deploy

```
mkdocs build
```

The generated static pages will need to be pushed to the `gh-pages` branch of
the Sherlock repository, to be served by GitHub. This can be done manually
with:

```
mkdocs gh-deploy
```

### Automated build and deploy

Commit and push.




[url_mkdocs]: http://mkdocs.org
[url_travis]: https://travisci.com

[url_repo]:           https://github.com/stanford-rc/sherlock
[url_landing_branch]: https://github.com/stanford-rc/sherlock/tree/web_landing
[url_theme_branch]:   https://github.com/stanford-rc/sherlock/tree/web_theme
[url_docs_branch]:    https://github.com/stanford-rc/sherlock/tree/web_docs
[url_mkdocs_material]: https://squidfunk.github.io/mkdocs-material

[url_webs]: https://docs.google.com/drawings/d/1ja1TyamMKqiemhwW7ZJgdSbmD9wy7xGXhPkNxOEvPE4/pub?w=842&amp;h=715
[url_webs_edit]: https://docs.google.com/drawings/d/1ja1TyamMKqiemhwW7ZJgdSbmD9wy7xGXhPkNxOEvPE4/edit


