# Sherlock tangly web of webs

## Overview

The Sherlock web presence is made of 3 components, each living in its own
branch of the [stanford-rc/www.sherlock.stanford.edu](https://github.com/stanford-rc/www.sherlock.stanford.edu) GitHub repository:

  1. a [landing page][url_landing_branch] (in branch [`landing`][url_landing_branch])
  2. a [documentation theme][url_theme_branch] (in branch [`theme`][url_theme_branch])
  3. [documentation pages](#documentation-pages), generated from Markdown by
     [MkDocs][url_mkdocs] (in branch [`docs`][url_docs_branch])

Each of those components has two parts:

  * a *source* directory, where modifications can be done,
  * a *build* directory, where final output is generated by a script

## Workflow

Each branch contains a [Travis][url_travis] configuration file, that will, on
each commit:

1. build the branch contents
2. deploy the generated contents if the build was successful

So for instance, a commit in the landing page branch will generate a Travis
build of the landing page, and the resulting HTML contents will be pushed and
committed to the `src/` directory in the `docs` branch.

This `docs` branch commit will in turn generate a Travis build of the
MkDocs pages, which will get pushed to the `gh-pages` branch for final
publication.

Basically:
* commit to landing page -> commit to docs -> publication
* commit to theme -> commit to docs -> publication
* commit to docs -> publication

This way, any change to any of the components will be automatically reflected
in the published site. But a modification to the landing page does not require
rebuilding the theme. And an update of the docs content does not trigger a full
rebuild of the landing page nor the theme either, just the docs themselves.

So the only required step when modifying one of the components is to commit the
changes and push them to GitHub.

Here's an overview of the whole workflow:

![webs][url_webs]
([edit][url_webs_edit]




# Components

Here's a description of each of those components, how to edit their contents
and publish them.

## [![Build Status][img_landing_buildstatus]][url_travis_branches] Landing page

See the [landing page][url_landing_branch] description.


## [![Build Status][img_theme_buildstatus]][url_travis_branches] Documentation theme

See the [documentation theme page][url_theme_branch] description.


## [![Build Status][img_docs_buildstatus]][url_travis_branches] Documentation pages

This branch of the Sherlock repository contains the source files necessary to
build the Sherlock documentation pages for
http://www.sherlock.stanford.edu/docs. It uses [MkDocs][url_mkdocs] to generate
static HTML pages from Markdown files.

There are two ways for editing documentation contents:
1. [editing in GitHub directly](#editing-in-github), which is very easy, but does not allow previewing the
   changes before publication,
2. [editing locally](#editing-locally) by cloning the repo, which allows previewing changes, but is a bit
   more involved to setup.

We recommend 1. for quick, typo-like edits, and 2. for more important
modifications (adding new pages, rewriting whole sections...)

### Editing in GitHub

Markdown pages can directly be edited within GitHub web interface. They're all
in the [`src/docs`](https://github.com/stanford-rc/www.sherlock.stanford.edu/tree/docs/src/docs)
directory.

Click on a file, click on the "Edit this file" button, edit, add a little
description about the change in the lower section, click on the green "Commit
changes" button, and voil√†, done.

You can also get to the page source on GitHub directly from the website by
clicking on the pencil icon in the right-top corner of every documentation page
on the website.

Behind the scenes, your commit should trigger a new site build through Travis,
which will be reflected on the website a few seconds later.


### Editing manually

The general idea is to clone the GitHub repository on your local machine, do
the modifications and preview the changes, then commit and push to GitHub.

#### Modifying

To modify the source files, you'll need to:

1. clone the `docs` branch of Sherlock repo on your local machine:
   ```
   $ git clone https://github.com/stanford-rc/www.sherlock.stanford.edu.git --branch docs --single-branch sherlock_docs
   ```
2. install the required dependencies with:
   ```
   $ cd sherlock_docs/
   $ pip install -r requirements.txt
   ```
3. start the development server
   ```
   $ mkdocs serve
   ```
   This will start a development server at http://127.0.0.1:8000

4. edit the documentation files as needed (see the official [MkDocs
   documentation][url_mkdocs] for more details).

    All the Markdown files live in `src/docs` and the MkDocs configuration
    (structure, plugins, site settings...) are in `mkdocs.yml`. Updates will
    automatically appear at http://127.0.0.1:8000 each time a file is saved.

5. commit the changes, when you're done with the modifications:
   ```
   $ git commit -m "my commit message" .
   ```

6. push the commit to trigger the rebuild:
   ```
   $ git push
   ```

7. Check http://www.sherlock.stanford.edu/docs to verify that your changes have
   been published.


That's it!

Next time you want to do an edit, no need to clone the whole repo again, you
can just pull the latest changes before editing, by running `git pull` within
the docs directory.



[url_mkdocs]:           http://mkdocs.org
[url_travis]:           https://travisci.com
[url_travis_branches]:  https://travis-ci.com/stanford-rc/www.sherlock.stanford.edu/branches

[url_repo]:             https://github.com/stanford-rc/www.sherlock.stanford.edu
[url_landing_branch]:   https://github.com/stanford-rc/www.sherlock.stanford.edu/tree/landing
[url_theme_branch]:     https://github.com/stanford-rc/www.sherlock.stanford.edu/tree/theme
[url_docs_branch]:      https://github.com/stanford-rc/www.sherlock.stanford.edu/tree/docs
[url_mkdocs_material]:  https://squidfunk.github.io/mkdocs-material

[url_webs]:      https://docs.google.com/drawings/d/1ja1TyamMKqiemhwW7ZJgdSbmD9wy7xGXhPkNxOEvPE4/pub?w=842&amp;h=715
[url_webs_edit]: https://docs.google.com/drawings/d/1ja1TyamMKqiemhwW7ZJgdSbmD9wy7xGXhPkNxOEvPE4/edit

[img_landing_buildstatus]: https://travis-ci.com/stanford-rc/www.sherlock.stanford.edu.svg?token=uginarQXUTdAZXLFvqnS&branch=landing
[img_theme_buildstatus]:   https://travis-ci.com/stanford-rc/www.sherlock.stanford.edu.svg?token=uginarQXUTdAZXLFvqnS&branch=theme
[img_docs_buildstatus]:    https://travis-ci.com/stanford-rc/www.sherlock.stanford.edu.svg?token=uginarQXUTdAZXLFvqnS&branch=docs

